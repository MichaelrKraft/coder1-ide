# ============================================
# CODER1 IDE - PRODUCTION DEPLOYMENT (RENDER)
# ============================================
# Single unified server architecture for production
# Optimized for Claude Code OAuth + AI Team functionality
# ============================================

# ============================================
# CORE SERVER CONFIGURATION
# ============================================
NODE_ENV=production
PORT=10000  # Render uses port 10000
HOSTNAME=0.0.0.0

# Memory Management (Critical for Render 512MB starter plan)
NODE_OPTIONS=--max-old-space-size=400 --expose-gc
MEMORY_PANIC_THRESHOLD_MB=380

# Production URLs
NEXT_PUBLIC_API_URL=https://coder1-ide.onrender.com
NEXT_PUBLIC_UNIFIED_SERVER_URL=https://coder1-ide.onrender.com
NEXT_PUBLIC_WEBSOCKET_URL=wss://coder1-ide.onrender.com
NEXT_PUBLIC_UNIFIED_SERVER=true

# ============================================
# CLAUDE CODE OAUTH INTEGRATION
# ============================================
# Claude Code OAuth Configuration
CLAUDE_CODE_OAUTH_ENABLED=true

# IMPORTANT: Get this token by running 'claude auth token' in your terminal
# The token should start with sk-ant-oat01-
# DO NOT use Anthropic Console API keys (sk-ant-api03-)
CLAUDE_CODE_OAUTH_TOKEN=# ADD YOUR OAUTH TOKEN HERE

# Optional for future features
CLAUDE_CODE_CLIENT_ID=# Optional - leave empty for now
CLAUDE_CODE_CLIENT_SECRET=# Optional - leave empty for now
CLAUDE_CODE_REDIRECT_URI=https://coder1-ide.onrender.com/auth/claude/callback

# Legacy API key support (deprecated, use OAuth token instead)
CLAUDE_API_KEY=# DEPRECATED - Use CLAUDE_CODE_OAUTH_TOKEN

# ============================================
# AI TEAM CONFIGURATION
# ============================================
# Enable AI Team features
ENABLE_AI_TEAM=true
ENABLE_CLI_PUPPETEER=true
ENABLE_CLAUDE_BRIDGE=true

# Bridge Service Configuration
ENABLE_BRIDGE_SERVICE=true
BRIDGE_AUTH_SECRET=change-this-to-secure-secret-in-production
BRIDGE_CONNECTION_TIMEOUT=30000

# Agent Terminal Tabs
NEXT_PUBLIC_ENABLE_AGENT_TABS=true

# ============================================
# ALPHA DEPLOYMENT SETTINGS
# ============================================
ALPHA_MODE_ENABLED=true
ALPHA_INVITE_CODE=CODER1ALPHA2025
MAX_ALPHA_USERS=50

# ============================================
# DATABASE & PERSISTENCE
# ============================================
# SQLite for alpha (upgrade to PostgreSQL for production scale)
DATABASE_URL=sqlite:///data/coder1-sessions.db

# Session Management (CHANGE THESE IN PRODUCTION!)
SESSION_SECRET=change-this-session-secret-in-production
JWT_SECRET=change-this-jwt-secret-in-production
SESSION_MAX_AGE=604800000  # 7 days

# ============================================
# WEBSOCKET & SECURITY CONFIGURATION
# ============================================
# WebSocket Security
ENABLE_WS_AUTHENTICATION=true
WS_AUTH_TIMEOUT=30000
WS_HEARTBEAT_INTERVAL=30000

# CORS Security
CORS_ORIGINS=https://coder1-ide.onrender.com
ENABLE_ORIGIN_VALIDATION=true

# Rate Limiting
ENABLE_RATE_LIMITING=true
RATE_LIMIT_REQUESTS=100
RATE_LIMIT_WINDOW=900000  # 15 minutes

# ============================================
# FEATURE FLAGS (PRODUCTION)
# ============================================
NEXT_PUBLIC_ENABLE_AI_CONSULTATION=true
NEXT_PUBLIC_ENABLE_AGENT_DASHBOARD=true
NEXT_PUBLIC_ENABLE_BRIDGE_DOWNLOAD=true
NEXT_PUBLIC_ENABLE_LOCAL_SYNC=true
NEXT_PUBLIC_ENABLE_TWEAKCC=false  # Disabled for alpha
NEXT_PUBLIC_ENABLE_CONTAINERS=false  # Disabled for alpha

# ============================================
# MONITORING & LOGGING
# ============================================
ENABLE_HEALTH_CHECKS=true
HEALTH_CHECK_INTERVAL=30000
LOG_LEVEL=info
ENABLE_REQUEST_LOGGING=true

# Performance Monitoring
ENABLE_PERFORMANCE_MONITORING=true
MEMORY_CHECK_INTERVAL=60000
NEXT_PUBLIC_MAX_FILE_SIZE=10485760
NEXT_PUBLIC_REQUEST_TIMEOUT=30000

# ============================================
# SECURITY HEADERS & COMPLIANCE
# ============================================
ENABLE_SECURITY_HEADERS=true
ENABLE_CSP=false  # Disable CSP temporarily for alpha testing
ENABLE_HSTS=true

# JWT Configuration
JWT_EXPIRES_IN=7d

# ============================================
# RENDER-SPECIFIC OPTIMIZATIONS
# ============================================
# Prevent Render sleep
RENDER_EXTERNAL_URL=https://coder1-ide.onrender.com
KEEP_ALIVE_ENABLED=false

# Build optimization
NEXT_TELEMETRY_DISABLED=1
ANALYZE=false

# ============================================
# DEPLOYMENT INSTRUCTIONS
# ============================================
# 1. Get Claude OAuth token: 
#    - Install Claude CLI: npm install -g claude
#    - Login: claude login
#    - Get token: claude auth token
#    
# 2. Add the OAuth token to CLAUDE_CODE_OAUTH_TOKEN above
#    
# 3. Generate secure secrets:
#    - SESSION_SECRET: openssl rand -base64 32
#    - JWT_SECRET: openssl rand -base64 32
#    - BRIDGE_AUTH_SECRET: openssl rand -base64 32
#    
# 4. Add these environment variables to Render dashboard:
#    - Go to your service settings
#    - Add all variables from this file
#    - Ensure secrets are properly set
#    
# 5. Deploy:
#    - Commit changes: git add . && git commit -m "Deploy to production"
#    - Push: git push origin master
#    - Monitor build logs in Render dashboard
# ============================================